- [x] **Fix worker concurrency issue**: Make the worker cleanup logic more robust to prevent race conditions from lingering connections after a deployment. This was causing `derive_statistical_unit` to fail intermittently. (2025-08-23)
- [x] **Fix post-import data derivation**: Corrected the import system to explicitly trigger `derive_statistical_unit` tasks after an import job completes. The previous mechanism relied on an incorrect `after_procedure` and unreliable statement-level triggers. (2025-08-25)
- [ ] **Implement partial `statistical_unit` refresh**: Develop a robust mechanism for partial, targeted refreshes of the `timeline_*` and `statistical_unit` tables. This will require a dynamic, hierarchical lookup of all affected units (e.g., finding an establishment's parent LU and enterprise) to ensure data consistency.
- [ ] **Add triggers for automatic refresh**: Implement database triggers on the core temporal tables (`legal_unit`, `establishment`, `activity`, etc.). These triggers will automatically queue a partial refresh task in the worker system whenever a relevant record is changed, ensuring the `statistical_unit` view is kept up-to-date.
- [ ] **Refactor `process_legal_unit`**: Remove the vestigial `tax_ident` column from the temporary table in `import.process_legal_unit` to improve clarity.
