                                                                              QUERY PLAN                                                                              
----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Hash Left Join  (cost=195.35..207.28 rows=49 width=3959)
   Hash Cond: ((NULL::integer) = eia3.unit_id)
   CTE external_idents_agg
     ->  HashAggregate  (cost=55.33..55.88 rows=44 width=40)
           Group Key: ('establishment'::statistical_unit_type), ei.establishment_id
           ->  Append  (cost=1.25..55.00 rows=44 width=400)
                 ->  Hash Join  (cost=1.25..13.70 rows=11 width=400)
                       Hash Cond: (eit.id = ei.type_id)
                       ->  Seq Scan on external_ident_type eit  (cost=0.00..11.70 rows=170 width=278)
                       ->  Hash  (cost=1.11..1.11 rows=11 width=126)
                             ->  Seq Scan on external_ident ei  (cost=0.00..1.11 rows=11 width=126)
                                   Filter: (establishment_id IS NOT NULL)
                 ->  Hash Join  (cost=1.25..13.70 rows=11 width=400)
                       Hash Cond: (eit_1.id = ei_1.type_id)
                       ->  Seq Scan on external_ident_type eit_1  (cost=0.00..11.70 rows=170 width=278)
                       ->  Hash  (cost=1.11..1.11 rows=11 width=126)
                             ->  Seq Scan on external_ident ei_1  (cost=0.00..1.11 rows=11 width=126)
                                   Filter: (legal_unit_id IS NOT NULL)
                 ->  Hash Join  (cost=1.25..13.70 rows=11 width=400)
                       Hash Cond: (eit_2.id = ei_2.type_id)
                       ->  Seq Scan on external_ident_type eit_2  (cost=0.00..11.70 rows=170 width=278)
                       ->  Hash  (cost=1.11..1.11 rows=11 width=126)
                             ->  Seq Scan on external_ident ei_2  (cost=0.00..1.11 rows=11 width=126)
                                   Filter: (enterprise_id IS NOT NULL)
                 ->  Hash Join  (cost=1.25..13.70 rows=11 width=400)
                       Hash Cond: (eit_3.id = ei_3.type_id)
                       ->  Seq Scan on external_ident_type eit_3  (cost=0.00..11.70 rows=170 width=278)
                       ->  Hash  (cost=1.11..1.11 rows=11 width=126)
                             ->  Seq Scan on external_ident ei_3  (cost=0.00..1.11 rows=11 width=126)
                                   Filter: (enterprise_group_id IS NOT NULL)
   ->  Hash Left Join  (cost=138.47..149.83 rows=49 width=3983)
         Hash Cond: ((NULL::integer) = eia2.unit_id)
         ->  Hash Right Join  (cost=137.47..148.64 rows=49 width=3955)
               Hash Cond: ((('establishment'::statistical_unit_type) = timeline_establishment.unit_type) AND (tfu.establishment_id = timeline_establishment.unit_id))
               ->  GroupAggregate  (cost=122.33..129.99 rows=200 width=40)
                     Group Key: ('establishment'::statistical_unit_type), tfu.establishment_id
                     ->  Sort  (cost=122.33..123.62 rows=516 width=40)
                           Sort Key: ('establishment'::statistical_unit_type), tfu.establishment_id, t.path
                           ->  Append  (cost=12.47..99.08 rows=516 width=40)
                                 ->  Hash Join  (cost=12.47..24.12 rows=129 width=40)
                                       Hash Cond: (tfu.tag_id = t.id)
                                       ->  Seq Scan on tag_for_unit tfu  (cost=0.00..11.30 rows=129 width=8)
                                             Filter: (establishment_id IS NOT NULL)
                                       ->  Hash  (cost=11.10..11.10 rows=110 width=36)
                                             ->  Seq Scan on tag t  (cost=0.00..11.10 rows=110 width=36)
                                 ->  Hash Join  (cost=12.47..24.12 rows=129 width=40)
                                       Hash Cond: (tfu_1.tag_id = t_1.id)
                                       ->  Seq Scan on tag_for_unit tfu_1  (cost=0.00..11.30 rows=129 width=8)
                                             Filter: (legal_unit_id IS NOT NULL)
                                       ->  Hash  (cost=11.10..11.10 rows=110 width=36)
                                             ->  Seq Scan on tag t_1  (cost=0.00..11.10 rows=110 width=36)
                                 ->  Hash Join  (cost=12.47..24.12 rows=129 width=40)
                                       Hash Cond: (tfu_2.tag_id = t_2.id)
                                       ->  Seq Scan on tag_for_unit tfu_2  (cost=0.00..11.30 rows=129 width=8)
                                             Filter: (enterprise_id IS NOT NULL)
                                       ->  Hash  (cost=11.10..11.10 rows=110 width=36)
                                             ->  Seq Scan on tag t_2  (cost=0.00..11.10 rows=110 width=36)
                                 ->  Hash Join  (cost=12.47..24.12 rows=129 width=40)
                                       Hash Cond: (tfu_3.tag_id = t_3.id)
                                       ->  Seq Scan on tag_for_unit tfu_3  (cost=0.00..11.30 rows=129 width=8)
                                             Filter: (enterprise_group_id IS NOT NULL)
                                       ->  Hash  (cost=11.10..11.10 rows=110 width=36)
                                             ->  Seq Scan on tag t_3  (cost=0.00..11.10 rows=110 width=36)
               ->  Hash  (cost=14.40..14.40 rows=49 width=3923)
                     ->  Hash Left Join  (cost=1.54..14.40 rows=49 width=3923)
                           Hash Cond: ((timeline_establishment.unit_type = eia1.unit_type) AND (timeline_establishment.unit_id = eia1.unit_id))
                           ->  Append  (cost=0.00..12.48 rows=49 width=3892)
                                 ->  Seq Scan on timeline_establishment  (cost=0.00..5.90 rows=15 width=3806)
                                 ->  Seq Scan on timeline_legal_unit  (cost=0.00..3.17 rows=17 width=3896)
                                 ->  Seq Scan on timeline_enterprise  (cost=0.00..3.17 rows=17 width=3963)
                           ->  Hash  (cost=0.88..0.88 rows=44 width=40)
                                 ->  CTE Scan on external_idents_agg eia1  (cost=0.00..0.88 rows=44 width=40)
         ->  Hash  (cost=0.99..0.99 rows=1 width=36)
               ->  CTE Scan on external_idents_agg eia2  (cost=0.00..0.99 rows=1 width=36)
                     Filter: (unit_type = 'establishment'::statistical_unit_type)
   ->  Hash  (cost=0.99..0.99 rows=1 width=36)
         ->  CTE Scan on external_idents_agg eia3  (cost=0.00..0.99 rows=1 width=36)
               Filter: (unit_type = 'legal_unit'::statistical_unit_type)
(78 rows)

