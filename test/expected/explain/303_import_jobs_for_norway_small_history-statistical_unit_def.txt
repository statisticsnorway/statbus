                                                                                    QUERY PLAN                                                                                     
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Hash Left Join
   Hash Cond: ((NULL::integer) = eia3.unit_id)
   CTE external_idents_agg
     ->  GroupAggregate
           Group Key: ('establishment'::statistical_unit_type), ei.establishment_id
           ->  Sort
                 Sort Key: ('establishment'::statistical_unit_type), ei.establishment_id
                 ->  Append
                       ->  Nested Loop
                             ->  Seq Scan on external_ident ei
                                   Filter: (establishment_id IS NOT NULL)
                             ->  Index Scan using external_ident_type_pkey on external_ident_type eit
                                   Index Cond: (id = ei.type_id)
                       ->  Nested Loop
                             ->  Seq Scan on external_ident ei_1
                                   Filter: (legal_unit_id IS NOT NULL)
                             ->  Index Scan using external_ident_type_pkey on external_ident_type eit_1
                                   Index Cond: (id = ei_1.type_id)
                       ->  Nested Loop
                             ->  Seq Scan on external_ident ei_2
                                   Filter: (enterprise_id IS NOT NULL)
                             ->  Index Scan using external_ident_type_pkey on external_ident_type eit_2
                                   Index Cond: (id = ei_2.type_id)
                       ->  Nested Loop
                             ->  Seq Scan on external_ident ei_3
                                   Filter: (enterprise_group_id IS NOT NULL)
                             ->  Index Scan using external_ident_type_pkey on external_ident_type eit_3
                                   Index Cond: (id = ei_3.type_id)
   ->  Hash Left Join
         Hash Cond: ((NULL::integer) = eia2.unit_id)
         ->  Merge Right Join
               Merge Cond: ((eia1.unit_type = timeline_establishment.unit_type) AND (eia1.unit_id = timeline_establishment.unit_id))
               ->  CTE Scan on external_idents_agg eia1
               ->  Materialize
                     ->  Merge Left Join
                           Merge Cond: ((timeline_establishment.unit_type = ('establishment'::statistical_unit_type)) AND (timeline_establishment.unit_id = tfu.establishment_id))
                           ->  Sort
                                 Sort Key: timeline_establishment.unit_type, timeline_establishment.unit_id
                                 ->  Append
                                       ->  Seq Scan on timeline_establishment
                                       ->  Seq Scan on timeline_legal_unit
                                       ->  Subquery Scan on "*SELECT* 3"
                                             ->  Seq Scan on timeline_enterprise
                           ->  GroupAggregate
                                 Group Key: ('establishment'::statistical_unit_type), tfu.establishment_id
                                 ->  Sort
                                       Sort Key: ('establishment'::statistical_unit_type), tfu.establishment_id, t.path
                                       ->  Append
                                             ->  Hash Join
                                                   Hash Cond: (tfu.tag_id = t.id)
                                                   ->  Seq Scan on tag_for_unit tfu
                                                         Filter: (establishment_id IS NOT NULL)
                                                   ->  Hash
                                                         ->  Seq Scan on tag t
                                             ->  Hash Join
                                                   Hash Cond: (tfu_1.tag_id = t_1.id)
                                                   ->  Seq Scan on tag_for_unit tfu_1
                                                         Filter: (legal_unit_id IS NOT NULL)
                                                   ->  Hash
                                                         ->  Seq Scan on tag t_1
                                             ->  Hash Join
                                                   Hash Cond: (tfu_2.tag_id = t_2.id)
                                                   ->  Seq Scan on tag_for_unit tfu_2
                                                         Filter: (enterprise_id IS NOT NULL)
                                                   ->  Hash
                                                         ->  Seq Scan on tag t_2
                                             ->  Hash Join
                                                   Hash Cond: (tfu_3.tag_id = t_3.id)
                                                   ->  Seq Scan on tag_for_unit tfu_3
                                                         Filter: (enterprise_group_id IS NOT NULL)
                                                   ->  Hash
                                                         ->  Seq Scan on tag t_3
         ->  Hash
               ->  CTE Scan on external_idents_agg eia2
                     Filter: (unit_type = 'establishment'::statistical_unit_type)
   ->  Hash
         ->  CTE Scan on external_idents_agg eia3
               Filter: (unit_type = 'legal_unit'::statistical_unit_type)
(78 rows)

