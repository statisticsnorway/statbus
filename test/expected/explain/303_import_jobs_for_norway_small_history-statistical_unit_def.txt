                                                                 QUERY PLAN                                                                 
--------------------------------------------------------------------------------------------------------------------------------------------
 Hash Left Join  (cost=176.51..198.63 rows=49 width=3987)
   Hash Cond: ((timeline_establishment.unit_type = tpa.unit_type) AND (timeline_establishment.unit_id = tpa.unit_id))
   CTE external_idents_agg
     ->  GroupAggregate  (cost=41.09..41.18 rows=4 width=40)
           Group Key: ('establishment'::statistical_unit_type), ei.establishment_id
           ->  Sort  (cost=41.09..41.10 rows=4 width=400)
                 Sort Key: ('establishment'::statistical_unit_type), ei.establishment_id
                 ->  Append  (cost=0.14..41.05 rows=4 width=400)
                       ->  Nested Loop  (cost=0.14..10.26 rows=1 width=400)
                             ->  Seq Scan on external_ident ei  (cost=0.00..2.00 rows=1 width=126)
                                   Filter: (establishment_id IS NOT NULL)
                             ->  Index Scan using external_ident_type_pkey on external_ident_type eit  (cost=0.14..8.16 rows=1 width=278)
                                   Index Cond: (id = ei.type_id)
                       ->  Nested Loop  (cost=0.14..10.26 rows=1 width=400)
                             ->  Seq Scan on external_ident ei_1  (cost=0.00..2.00 rows=1 width=126)
                                   Filter: (legal_unit_id IS NOT NULL)
                             ->  Index Scan using external_ident_type_pkey on external_ident_type eit_1  (cost=0.14..8.16 rows=1 width=278)
                                   Index Cond: (id = ei_1.type_id)
                       ->  Nested Loop  (cost=0.14..10.26 rows=1 width=400)
                             ->  Seq Scan on external_ident ei_2  (cost=0.00..2.00 rows=1 width=126)
                                   Filter: (enterprise_id IS NOT NULL)
                             ->  Index Scan using external_ident_type_pkey on external_ident_type eit_2  (cost=0.14..8.16 rows=1 width=278)
                                   Index Cond: (id = ei_2.type_id)
                       ->  Nested Loop  (cost=0.14..10.26 rows=1 width=400)
                             ->  Seq Scan on external_ident ei_3  (cost=0.00..2.00 rows=1 width=126)
                                   Filter: (enterprise_group_id IS NOT NULL)
                             ->  Index Scan using external_ident_type_pkey on external_ident_type eit_3  (cost=0.14..8.16 rows=1 width=278)
                                   Index Cond: (id = ei_3.type_id)
   ->  Hash Left Join  (cost=0.35..21.85 rows=49 width=4007)
         Hash Cond: ((NULL::integer) = eia3.unit_id)
         ->  Hash Left Join  (cost=0.24..21.55 rows=49 width=3979)
               Hash Cond: ((NULL::integer) = eia2.unit_id)
               ->  Hash Left Join  (cost=0.14..21.25 rows=49 width=3951)
                     Hash Cond: ((timeline_establishment.unit_type = eia1.unit_type) AND (timeline_establishment.unit_id = eia1.unit_id))
                     ->  Append  (cost=0.00..20.74 rows=49 width=3920)
                           ->  Seq Scan on timeline_establishment  (cost=0.00..9.15 rows=15 width=3900)
                           ->  Seq Scan on timeline_legal_unit  (cost=0.00..6.17 rows=17 width=3895)
                           ->  Seq Scan on timeline_enterprise  (cost=0.00..5.17 rows=17 width=3963)
                     ->  Hash  (cost=0.08..0.08 rows=4 width=40)
                           ->  CTE Scan on external_idents_agg eia1  (cost=0.00..0.08 rows=4 width=40)
               ->  Hash  (cost=0.09..0.09 rows=1 width=36)
                     ->  CTE Scan on external_idents_agg eia2  (cost=0.00..0.09 rows=1 width=36)
                           Filter: (unit_type = 'establishment'::statistical_unit_type)
         ->  Hash  (cost=0.09..0.09 rows=1 width=36)
               ->  CTE Scan on external_idents_agg eia3  (cost=0.00..0.09 rows=1 width=36)
                     Filter: (unit_type = 'legal_unit'::statistical_unit_type)
   ->  Hash  (cost=131.99..131.99 rows=200 width=40)
         ->  Subquery Scan on tpa  (cost=122.33..131.99 rows=200 width=40)
               ->  GroupAggregate  (cost=122.33..129.99 rows=200 width=40)
                     Group Key: ('establishment'::statistical_unit_type), tfu.establishment_id
                     ->  Sort  (cost=122.33..123.62 rows=516 width=40)
                           Sort Key: ('establishment'::statistical_unit_type), tfu.establishment_id, t.path
                           ->  Append  (cost=12.47..99.08 rows=516 width=40)
                                 ->  Hash Join  (cost=12.47..24.12 rows=129 width=40)
                                       Hash Cond: (tfu.tag_id = t.id)
                                       ->  Seq Scan on tag_for_unit tfu  (cost=0.00..11.30 rows=129 width=8)
                                             Filter: (establishment_id IS NOT NULL)
                                       ->  Hash  (cost=11.10..11.10 rows=110 width=36)
                                             ->  Seq Scan on tag t  (cost=0.00..11.10 rows=110 width=36)
                                 ->  Hash Join  (cost=12.47..24.12 rows=129 width=40)
                                       Hash Cond: (tfu_1.tag_id = t_1.id)
                                       ->  Seq Scan on tag_for_unit tfu_1  (cost=0.00..11.30 rows=129 width=8)
                                             Filter: (legal_unit_id IS NOT NULL)
                                       ->  Hash  (cost=11.10..11.10 rows=110 width=36)
                                             ->  Seq Scan on tag t_1  (cost=0.00..11.10 rows=110 width=36)
                                 ->  Hash Join  (cost=12.47..24.12 rows=129 width=40)
                                       Hash Cond: (tfu_2.tag_id = t_2.id)
                                       ->  Seq Scan on tag_for_unit tfu_2  (cost=0.00..11.30 rows=129 width=8)
                                             Filter: (enterprise_id IS NOT NULL)
                                       ->  Hash  (cost=11.10..11.10 rows=110 width=36)
                                             ->  Seq Scan on tag t_2  (cost=0.00..11.10 rows=110 width=36)
                                 ->  Hash Join  (cost=12.47..24.12 rows=129 width=40)
                                       Hash Cond: (tfu_3.tag_id = t_3.id)
                                       ->  Seq Scan on tag_for_unit tfu_3  (cost=0.00..11.30 rows=129 width=8)
                                             Filter: (enterprise_group_id IS NOT NULL)
                                       ->  Hash  (cost=11.10..11.10 rows=110 width=36)
                                             ->  Seq Scan on tag t_3  (cost=0.00..11.10 rows=110 width=36)
(77 rows)

