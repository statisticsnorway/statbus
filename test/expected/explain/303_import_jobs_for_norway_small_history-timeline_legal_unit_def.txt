                                                                                                                                                                                                   QUERY PLAN                                                                                                                                                                                                    
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort
   Sort Key: t.unit_type, t.unit_id, t.valid_from
   CTE filter_ids
     ->  Result
   ->  Nested Loop
         Disabled: true
         ->  Hash Left Join
               Hash Cond: ((t.unit_id = esa.unit_id) AND (t.valid_from = esa.valid_from))
               ->  Nested Loop Left Join
                     Disabled: true
                     ->  Nested Loop Left Join
                           Disabled: true
                           ->  Nested Loop Left Join
                                 Disabled: true
                                 ->  Nested Loop Left Join
                                       Disabled: true
                                       ->  Nested Loop Left Join
                                             Disabled: true
                                             ->  Nested Loop Left Join
                                                   Disabled: true
                                                   ->  Nested Loop Left Join
                                                         Disabled: true
                                                         ->  Nested Loop Left Join
                                                               Disabled: true
                                                               ->  Nested Loop Left Join
                                                                     Disabled: true
                                                                     ->  Hash Left Join
                                                                           Hash Cond: ((t.unit_id = lu_stats.unit_id) AND (t.valid_from = lu_stats.valid_from))
                                                                           ->  Hash Left Join
                                                                                 Hash Cond: (lu_1.unit_size_id = us.id)
                                                                                 ->  Hash Right Join
                                                                                       Hash Cond: (s.id = lu_1.sector_id)
                                                                                       ->  Seq Scan on sector s
                                                                                       ->  Hash
                                                                                             ->  Hash Left Join
                                                                                                   Hash Cond: (lu_1.status_id = st.id)
                                                                                                   ->  Hash Right Join
                                                                                                         Hash Cond: (lf.id = lu_1.legal_form_id)
                                                                                                         ->  Seq Scan on legal_form lf
                                                                                                         ->  Hash
                                                                                                               ->  Nested Loop
                                                                                                                     Disabled: true
                                                                                                                     ->  Nested Loop
                                                                                                                           Disabled: true
                                                                                                                           Join Filter: ((f.ids IS NULL) OR (t.unit_id = ANY (f.ids)))
                                                                                                                           ->  CTE Scan on filter_ids f
                                                                                                                           ->  Seq Scan on timesegments t
                                                                                                                                 Filter: (unit_type = 'legal_unit'::statistical_unit_type)
                                                                                                                     ->  Limit
                                                                                                                           ->  Sort
                                                                                                                                 Sort Key: lu_1.valid_from DESC
                                                                                                                                 ->  Seq Scan on legal_unit lu_1
                                                                                                                                       Filter: ((t.valid_from < valid_until) AND (valid_from < t.valid_until) AND (id = t.unit_id))
                                                                                                   ->  Hash
                                                                                                         ->  Seq Scan on status st
                                                                                 ->  Hash
                                                                                       ->  Seq Scan on unit_size us
                                                                           ->  Hash
                                                                                 ->  Subquery Scan on lu_stats
                                                                                       ->  GroupAggregate
                                                                                             Group Key: t_1.unit_id, t_1.valid_from
                                                                                             ->  Sort
                                                                                                   Sort Key: t_1.unit_id, t_1.valid_from
                                                                                                   ->  Hash Join
                                                                                                         Hash Cond: (sfu.stat_definition_id = sd.id)
                                                                                                         ->  Hash Join
                                                                                                               Hash Cond: (sfu.legal_unit_id = t_1.unit_id)
                                                                                                               Join Filter: ((t_1.valid_from < sfu.valid_until) AND (sfu.valid_from < t_1.valid_until))
                                                                                                               ->  Seq Scan on stat_for_unit sfu
                                                                                                               ->  Hash
                                                                                                                     ->  Nested Loop
                                                                                                                           Disabled: true
                                                                                                                           Join Filter: ((f_1.ids IS NULL) OR (t_1.unit_id = ANY (f_1.ids)))
                                                                                                                           ->  CTE Scan on filter_ids f_1
                                                                                                                           ->  Seq Scan on timesegments t_1
                                                                                                                                 Filter: (unit_type = 'legal_unit'::statistical_unit_type)
                                                                                                         ->  Hash
                                                                                                               ->  Seq Scan on stat_definition sd
                                                                     ->  Hash Right Join
                                                                           Hash Cond: (pac.id = pa.category_id)
                                                                           ->  Seq Scan on activity_category pac
                                                                           ->  Hash
                                                                                 ->  Subquery Scan on pa
                                                                                       ->  Limit
                                                                                             ->  Sort
                                                                                                   Sort Key: a.id DESC
                                                                                                   ->  Seq Scan on activity a
                                                                                                         Filter: ((t.valid_from < valid_until) AND (valid_from < t.valid_until) AND (legal_unit_id = lu_1.id) AND (type = 'primary'::activity_type))
                                                               ->  Hash Right Join
                                                                     Hash Cond: (sac.id = sa.category_id)
                                                                     ->  Seq Scan on activity_category sac
                                                                     ->  Hash
                                                                           ->  Subquery Scan on sa
                                                                                 ->  Limit
                                                                                       ->  Sort
                                                                                             Sort Key: a_1.id DESC
                                                                                             ->  Seq Scan on activity a_1
                                                                                                   Filter: ((t.valid_from < valid_until) AND (valid_from < t.valid_until) AND (legal_unit_id = lu_1.id) AND (type = 'secondary'::activity_type))
                                                         ->  Hash Right Join
                                                               Hash Cond: (phr.id = phl.region_id)
                                                               ->  Seq Scan on region phr
                                                               ->  Hash
                                                                     ->  Hash Right Join
                                                                           Hash Cond: (phc.id = phl.country_id)
                                                                           ->  Seq Scan on country phc
                                                                           ->  Hash
                                                                                 ->  Subquery Scan on phl
                                                                                       ->  Limit
                                                                                             ->  Sort
                                                                                                   Sort Key: l.id DESC
                                                                                                   ->  Index Scan using location_type_establishment_id_valid on location l
                                                                                                         Index Cond: ((type = 'physical'::location_type) AND (legal_unit_id = lu_1.id))
                                                                                                         Filter: ((t.valid_from < valid_until) AND (valid_from < t.valid_until))
                                                   ->  Hash Right Join
                                                         Hash Cond: (poc.id = pol.country_id)
                                                         ->  Seq Scan on country poc
                                                         ->  Hash
                                                               ->  Hash Right Join
                                                                     Hash Cond: (por.id = pol.region_id)
                                                                     ->  Seq Scan on region por
                                                                     ->  Hash
                                                                           ->  Subquery Scan on pol
                                                                                 ->  Limit
                                                                                       ->  Sort
                                                                                             Sort Key: l_1.id DESC
                                                                                             ->  Index Scan using location_type_establishment_id_valid on location l_1
                                                                                                   Index Cond: ((type = 'postal'::location_type) AND (legal_unit_id = lu_1.id))
                                                                                                   Filter: ((t.valid_from < valid_until) AND (valid_from < t.valid_until))
                                             ->  Limit
                                                   ->  Sort
                                                         Sort Key: c_1.id DESC
                                                         ->  Seq Scan on contact c_1
                                                               Filter: ((t.valid_from < valid_until) AND (valid_from < t.valid_until) AND (legal_unit_id = lu_1.id))
                                       ->  Aggregate
                                             ->  Sort
                                                   Sort Key: sfu_1.data_source_id
                                                   ->  Bitmap Heap Scan on stat_for_unit sfu_1
                                                         Recheck Cond: (legal_unit_id = lu_1.id)
                                                         Filter: ((t.valid_from < valid_until) AND (valid_from < t.valid_until))
                                                         ->  Bitmap Index Scan on stat_for_unit_natural_key_valid
                                                               Index Cond: (legal_unit_id = lu_1.id)
                                 ->  Limit
                                       ->  Sort
                                             Sort Key: sfu_2.edit_at DESC
                                             ->  Bitmap Heap Scan on stat_for_unit sfu_2
                                                   Recheck Cond: (legal_unit_id = lu_1.id)
                                                   Filter: ((t.valid_from < valid_until) AND (valid_from < t.valid_until))
                                                   ->  Bitmap Index Scan on stat_for_unit_natural_key_valid
                                                         Index Cond: (legal_unit_id = lu_1.id)
                           ->  Aggregate
                                 ->  Seq Scan on data_source ds_1
                                       Filter: (COALESCE((id = lu_1.data_source_id), false) OR COALESCE((id = pa.data_source_id), false) OR COALESCE((id = sa.data_source_id), false) OR COALESCE((id = phl.data_source_id), false) OR COALESCE((id = pol.data_source_id), false) OR COALESCE((id = ANY ((array_agg(DISTINCT sfu_1.data_source_id) FILTER (WHERE (sfu_1.data_source_id IS NOT NULL))))), false))
                     ->  Limit
                           ->  Sort
                                 Sort Key: "*VALUES*".column3 DESC
                                 ->  Values Scan on "*VALUES*"
                                       Filter: (column3 IS NOT NULL)
               ->  Hash
                     ->  Subquery Scan on esa
                           ->  GroupAggregate
                                 Group Key: t_2.unit_id, t_2.valid_from
                                 ->  Sort
                                       Sort Key: t_2.unit_id, t_2.valid_from, tes.establishment_id
                                       ->  Hash Join
                                             Hash Cond: (tes.legal_unit_id = t_2.unit_id)
                                             Join Filter: ((t_2.valid_from < tes.valid_until) AND (tes.valid_from < t_2.valid_until))
                                             ->  Seq Scan on timeline_establishment tes
                                             ->  Hash
                                                   ->  Nested Loop
                                                         Disabled: true
                                                         Join Filter: ((f_2.ids IS NULL) OR (t_2.unit_id = ANY (f_2.ids)))
                                                         ->  CTE Scan on filter_ids f_2
                                                         ->  Seq Scan on timesegments t_2
                                                               Filter: (unit_type = 'legal_unit'::statistical_unit_type)
         ->  Seq Scan on settings current_settings
         SubPlan 2
           ->  Aggregate
                 ->  Sort
                       Sort Key: (unnest(COALESCE((array_agg(ds_1.id)), '{}'::integer[])))
                       ->  Append
                             ->  ProjectSet
                                   ->  Result
                             ->  ProjectSet
                                   ->  Result
         SubPlan 3
           ->  Aggregate
                 ->  Sort
                       Sort Key: (unnest(COALESCE((array_agg(ds_1.code)), '{}'::text[])))
                       ->  Append
                             ->  ProjectSet
                                   ->  Result
                             ->  ProjectSet
                                   ->  Result
(193 rows)

