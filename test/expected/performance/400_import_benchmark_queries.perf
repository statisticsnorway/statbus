 # Slow Query Analysis from pg_stat_monitor

 # Queries sorted by total execution time

 #

 

                 header                 
----------------------------------------
 # Top queries by total execution time:

       queryid        | calls | total_exec_time_ms | avg_exec_time_ms | rows | avg_blks_per_call |                                                                                              query_preview                                                                                               
----------------------+-------+--------------------+------------------+------+-------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 -7756881634528651135 |     1 |            8080.06 |          8080.06 |    0 |            728390 | CALL worker.process_tasks(p_queue => 'import')
 -4765455770355021261 |     4 |             360.97 |            90.24 |    4 |             42252 | WITH def AS (SELECT id FROM public.import_definition WHERE slug = 'brreg_hovedenhet_2024') INSERT INTO public.import_job (definition_id, slug, default_valid_from, default_valid_to, description, note, 
 -4765455770355021261 |     4 |             360.29 |            90.07 |    4 |             41990 | WITH def AS (SELECT id FROM public.import_definition WHERE slug = 'brreg_underenhet_2024') INSERT INTO public.import_job (definition_id, slug, default_valid_from, default_valid_to, description, note, 
 1531659447956301506  |     1 |             274.02 |           274.02 | 1811 |            107463 | COPY  public.activity_category_available_custom FROM STDIN WITH (FORMAT csv, DELIMITER ',', QUOTE '"', HEADER true)
 1052271457547232584  |     1 |              72.83 |            72.83 |    0 |             22039 | DO $$ DECLARE     def_id INT;     -- Define the steps needed for a legal unit import with a time context     lu_steps TEXT[] := ARRAY[         'external_idents', 'data_source', 'enterprise_link_for_le
 -9021270608079698164 |     1 |              44.41 |            44.41 |  417 |              6550 | COPY  public.region_upload ( path, name ) FROM STDIN WITH (FORMAT csv, DELIMITER ',', QUOTE '"', HEADER true)
 -2962929541135827136 |     1 |              39.49 |            39.49 |    0 |             11177 | GRANT EXECUTE ON FUNCTION test.sudo_exec(text) TO PUBLIC
 7019081064433354957  |     3 |              34.52 |            11.51 |    3 |               387 | SELECT * FROM public.user_create(p_display_name => 'Test Admin', p_email => 'test.admin@statbus.org', p_statbus_role => 'admin_user'::statbus_role, p_password => 'Admin#123!')
 5136479471288593010  |     1 |              34.52 |            34.52 |    0 |             13859 | DO $$ DECLARE     def_id INT;     -- Define the steps needed for an establishment linked to a legal unit import with a time context     es_steps TEXT[] := ARRAY[         'external_idents', 'data_sourc
 6954822028827459011  |     1 |              15.66 |            15.66 |    0 |                89 | DO $$ BEGIN     IF EXISTS (SELECT 1 FROM pg_extension WHERE extname = 'pg_stat_monitor') THEN         PERFORM pg_stat_monitor_reset();     END IF; END; $$

