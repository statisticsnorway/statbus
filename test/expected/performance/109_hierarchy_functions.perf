 # Benchmark: statistical_unit_stats and relevant_statistical_units

 # Date: 2026-02-28 01:12:29.743588-08

 

 ## EXPLAIN ANALYZE: statistical_unit_stats (legal_unit, stat_ident=1000)

                                                                                                                                QUERY PLAN                                                                                                                                
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=24.90..24.90 rows=2 width=645) (actual time=0.128..0.130 rows=4.00 loops=1)
   Sort Key: su.unit_type, su.unit_id
   Sort Method: quicksort  Memory: 27kB
   Buffers: shared hit=13
   CTE root_unit
     ->  Bitmap Heap Scan on statistical_unit su_1  (cost=1.50..2.87 rows=1 width=51) (actual time=0.102..0.102 rows=1.00 loops=1)
           Recheck Cond: ((valid_from <= '2024-01-01'::date) AND ('2024-01-01'::date < valid_until) AND (unit_type = 'enterprise'::statistical_unit_type) AND (unit_id = statistical_unit_enterprise_id('legal_unit'::statistical_unit_type, 1, '2024-01-01'::date)))
           Heap Blocks: exact=1
           Buffers: shared hit=3
           ->  Bitmap Index Scan on statistical_unit_from_key  (cost=0.00..1.50 rows=1 width=0) (actual time=0.099..0.099 rows=1.00 loops=1)
                 Index Cond: ((valid_from <= '2024-01-01'::date) AND (valid_until > '2024-01-01'::date) AND (unit_type = 'enterprise'::statistical_unit_type) AND (unit_id = statistical_unit_enterprise_id('legal_unit'::statistical_unit_type, 1, '2024-01-01'::date)))
                 Index Searches: 1
                 Buffers: shared hit=2
   ->  Hash Join  (cost=0.28..22.02 rows=2 width=645) (actual time=0.117..0.124 rows=4.00 loops=1)
         Hash Cond: ((su.unit_type = ('enterprise'::statistical_unit_type)) AND (su.unit_id = ru.unit_id))
         Buffers: shared hit=13
         ->  Index Scan using idx_statistical_unit_establishment_id on statistical_unit su  (cost=0.14..21.77 rows=11 width=645) (actual time=0.005..0.011 rows=11.00 loops=1)
               Filter: ((valid_from <= '2024-01-01'::date) AND ('2024-01-01'::date < valid_until))
               Index Searches: 1
               Buffers: shared hit=10
         ->  Hash  (cost=0.10..0.10 rows=3 width=8) (actual time=0.109..0.110 rows=4.00 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 9kB
               Buffers: shared hit=3
               ->  Append  (cost=0.00..0.10 rows=3 width=8) (actual time=0.103..0.107 rows=4.00 loops=1)
                     Buffers: shared hit=3
                     ->  CTE Scan on root_unit ru  (cost=0.00..0.02 rows=1 width=8) (actual time=0.103..0.103 rows=1.00 loops=1)
                           Storage: Memory  Maximum Storage: 17kB
                           Buffers: shared hit=3
                     ->  ProjectSet  (cost=0.00..0.03 rows=1 width=8) (actual time=0.002..0.002 rows=1.00 loops=1)
                           ->  CTE Scan on root_unit ru_1  (cost=0.00..0.02 rows=1 width=32) (actual time=0.000..0.000 rows=1.00 loops=1)
                                 Storage: Memory  Maximum Storage: 17kB
                     ->  ProjectSet  (cost=0.00..0.03 rows=1 width=8) (actual time=0.000..0.001 rows=2.00 loops=1)
                           ->  CTE Scan on root_unit ru_2  (cost=0.00..0.02 rows=1 width=32) (actual time=0.000..0.000 rows=1.00 loops=1)
                                 Storage: Memory  Maximum Storage: 17kB
 Planning:
   Buffers: shared hit=1
 Planning Time: 0.536 ms
 Execution Time: 0.156 ms

 

 ## EXPLAIN ANALYZE: statistical_unit_stats (enterprise, stat_ident=3001)

                                                                                                                                QUERY PLAN                                                                                                                                
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=24.90..24.90 rows=2 width=645) (actual time=0.153..0.155 rows=2.00 loops=1)
   Sort Key: su.unit_type, su.unit_id
   Sort Method: quicksort  Memory: 26kB
   Buffers: shared hit=14
   CTE root_unit
     ->  Bitmap Heap Scan on statistical_unit su_1  (cost=1.50..2.87 rows=1 width=51) (actual time=0.133..0.133 rows=1.00 loops=1)
           Recheck Cond: ((valid_from <= '2024-01-01'::date) AND ('2024-01-01'::date < valid_until) AND (unit_type = 'enterprise'::statistical_unit_type) AND (unit_id = statistical_unit_enterprise_id('enterprise'::statistical_unit_type, 4, '2024-01-01'::date)))
           Heap Blocks: exact=1
           Buffers: shared hit=4
           ->  Bitmap Index Scan on statistical_unit_from_key  (cost=0.00..1.50 rows=1 width=0) (actual time=0.131..0.131 rows=1.00 loops=1)
                 Index Cond: ((valid_from <= '2024-01-01'::date) AND (valid_until > '2024-01-01'::date) AND (unit_type = 'enterprise'::statistical_unit_type) AND (unit_id = statistical_unit_enterprise_id('enterprise'::statistical_unit_type, 4, '2024-01-01'::date)))
                 Index Searches: 1
                 Buffers: shared hit=3
   ->  Hash Join  (cost=0.28..22.02 rows=2 width=645) (actual time=0.150..0.151 rows=2.00 loops=1)
         Hash Cond: ((su.unit_type = ('enterprise'::statistical_unit_type)) AND (su.unit_id = ru.unit_id))
         Buffers: shared hit=14
         ->  Index Scan using idx_statistical_unit_establishment_id on statistical_unit su  (cost=0.14..21.77 rows=11 width=645) (actual time=0.004..0.009 rows=11.00 loops=1)
               Filter: ((valid_from <= '2024-01-01'::date) AND ('2024-01-01'::date < valid_until))
               Index Searches: 1
               Buffers: shared hit=10
         ->  Hash  (cost=0.10..0.10 rows=3 width=8) (actual time=0.139..0.139 rows=2.00 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 9kB
               Buffers: shared hit=4
               ->  Append  (cost=0.00..0.10 rows=3 width=8) (actual time=0.134..0.138 rows=2.00 loops=1)
                     Buffers: shared hit=4
                     ->  CTE Scan on root_unit ru  (cost=0.00..0.02 rows=1 width=8) (actual time=0.134..0.135 rows=1.00 loops=1)
                           Storage: Memory  Maximum Storage: 17kB
                           Buffers: shared hit=4
                     ->  ProjectSet  (cost=0.00..0.03 rows=1 width=8) (actual time=0.001..0.001 rows=0.00 loops=1)
                           ->  CTE Scan on root_unit ru_1  (cost=0.00..0.02 rows=1 width=32) (actual time=0.000..0.000 rows=1.00 loops=1)
                                 Storage: Memory  Maximum Storage: 17kB
                     ->  ProjectSet  (cost=0.00..0.03 rows=1 width=8) (actual time=0.001..0.001 rows=1.00 loops=1)
                           ->  CTE Scan on root_unit ru_2  (cost=0.00..0.02 rows=1 width=32) (actual time=0.000..0.000 rows=1.00 loops=1)
                                 Storage: Memory  Maximum Storage: 17kB
 Planning:
   Buffers: shared hit=2
 Planning Time: 0.542 ms
 Execution Time: 0.173 ms

 

 ## EXPLAIN ANALYZE: relevant_statistical_units (legal_unit, stat_ident=1000)

                                                                                                                                QUERY PLAN                                                                                                                                
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on full_units  (cost=27.01..27.04 rows=2 width=6112) (actual time=0.150..0.154 rows=4.00 loops=1)
   Buffers: shared hit=17
   CTE root_unit
     ->  Bitmap Heap Scan on statistical_unit su_1  (cost=1.50..2.87 rows=1 width=109) (actual time=0.098..0.098 rows=1.00 loops=1)
           Recheck Cond: ((valid_from <= '2024-01-01'::date) AND ('2024-01-01'::date < valid_until) AND (unit_type = 'enterprise'::statistical_unit_type) AND (unit_id = statistical_unit_enterprise_id('legal_unit'::statistical_unit_type, 1, '2024-01-01'::date)))
           Heap Blocks: exact=1
           Buffers: shared hit=3
           ->  Bitmap Index Scan on statistical_unit_from_key  (cost=0.00..1.50 rows=1 width=0) (actual time=0.095..0.095 rows=1.00 loops=1)
                 Index Cond: ((valid_from <= '2024-01-01'::date) AND (valid_until > '2024-01-01'::date) AND (unit_type = 'enterprise'::statistical_unit_type) AND (unit_id = statistical_unit_enterprise_id('legal_unit'::statistical_unit_type, 1, '2024-01-01'::date)))
                 Index Searches: 1
                 Buffers: shared hit=2
   ->  Sort  (cost=24.14..24.15 rows=2 width=6144) (actual time=0.146..0.148 rows=4.00 loops=1)
         Sort Key: su.unit_type, ((su.external_idents ->> (eit.code)::text)), su.unit_id
         Sort Method: quicksort  Memory: 30kB
         Buffers: shared hit=17
         ->  Nested Loop Left Join  (cost=1.31..24.13 rows=2 width=6144) (actual time=0.122..0.138 rows=4.00 loops=1)
               Disabled: true
               Buffers: shared hit=17
               ->  Hash Join  (cost=0.28..22.02 rows=2 width=6080) (actual time=0.111..0.120 rows=4.00 loops=1)
                     Hash Cond: ((su.unit_type = ('enterprise'::statistical_unit_type)) AND (su.unit_id = ru.unit_id))
                     Buffers: shared hit=13
                     ->  Index Scan using idx_statistical_unit_establishment_id on statistical_unit su  (cost=0.14..21.77 rows=11 width=6080) (actual time=0.004..0.011 rows=11.00 loops=1)
                           Filter: ((valid_from <= '2024-01-01'::date) AND ('2024-01-01'::date < valid_until))
                           Index Searches: 1
                           Buffers: shared hit=10
                     ->  Hash  (cost=0.10..0.10 rows=3 width=8) (actual time=0.104..0.104 rows=4.00 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 9kB
                           Buffers: shared hit=3
                           ->  Append  (cost=0.00..0.10 rows=3 width=8) (actual time=0.099..0.102 rows=4.00 loops=1)
                                 Buffers: shared hit=3
                                 ->  CTE Scan on root_unit ru  (cost=0.00..0.02 rows=1 width=8) (actual time=0.099..0.099 rows=1.00 loops=1)
                                       Storage: Memory  Maximum Storage: 17kB
                                       Buffers: shared hit=3
                                 ->  ProjectSet  (cost=0.00..0.03 rows=1 width=8) (actual time=0.001..0.002 rows=1.00 loops=1)
                                       ->  CTE Scan on root_unit ru_1  (cost=0.00..0.02 rows=1 width=32) (actual time=0.000..0.000 rows=1.00 loops=1)
                                             Storage: Memory  Maximum Storage: 17kB
                                 ->  ProjectSet  (cost=0.00..0.03 rows=1 width=8) (actual time=0.000..0.001 rows=2.00 loops=1)
                                       ->  CTE Scan on root_unit ru_2  (cost=0.00..0.02 rows=1 width=32) (actual time=0.000..0.000 rows=1.00 loops=1)
                                             Storage: Memory  Maximum Storage: 17kB
               ->  Limit  (cost=1.03..1.04 rows=1 width=310) (actual time=0.003..0.004 rows=1.00 loops=4)
                     Buffers: shared hit=4
                     ->  Sort  (cost=1.03..1.04 rows=2 width=310) (actual time=0.003..0.003 rows=1.00 loops=4)
                           Sort Key: eit.priority
                           Sort Method: quicksort  Memory: 25kB
                           Buffers: shared hit=4
                           ->  Seq Scan on external_ident_type eit  (cost=0.00..1.02 rows=2 width=310) (actual time=0.002..0.002 rows=2.00 loops=4)
                                 Buffers: shared hit=4
 Planning:
   Buffers: shared hit=3
 Planning Time: 0.896 ms
 Execution Time: 0.209 ms

 

 ## EXPLAIN ANALYZE: relevant_statistical_units (enterprise, stat_ident=3001)

                                                                                                                                QUERY PLAN                                                                                                                                
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on full_units  (cost=27.01..27.04 rows=2 width=6112) (actual time=0.186..0.188 rows=2.00 loops=1)
   Buffers: shared hit=16
   CTE root_unit
     ->  Bitmap Heap Scan on statistical_unit su_1  (cost=1.50..2.87 rows=1 width=109) (actual time=0.147..0.147 rows=1.00 loops=1)
           Recheck Cond: ((valid_from <= '2024-01-01'::date) AND ('2024-01-01'::date < valid_until) AND (unit_type = 'enterprise'::statistical_unit_type) AND (unit_id = statistical_unit_enterprise_id('enterprise'::statistical_unit_type, 4, '2024-01-01'::date)))
           Heap Blocks: exact=1
           Buffers: shared hit=4
           ->  Bitmap Index Scan on statistical_unit_from_key  (cost=0.00..1.50 rows=1 width=0) (actual time=0.144..0.144 rows=1.00 loops=1)
                 Index Cond: ((valid_from <= '2024-01-01'::date) AND (valid_until > '2024-01-01'::date) AND (unit_type = 'enterprise'::statistical_unit_type) AND (unit_id = statistical_unit_enterprise_id('enterprise'::statistical_unit_type, 4, '2024-01-01'::date)))
                 Index Searches: 1
                 Buffers: shared hit=3
   ->  Sort  (cost=24.14..24.15 rows=2 width=6144) (actual time=0.183..0.185 rows=2.00 loops=1)
         Sort Key: su.unit_type, ((su.external_idents ->> (eit.code)::text)), su.unit_id
         Sort Method: quicksort  Memory: 27kB
         Buffers: shared hit=16
         ->  Nested Loop Left Join  (cost=1.31..24.13 rows=2 width=6144) (actual time=0.174..0.179 rows=2.00 loops=1)
               Disabled: true
               Buffers: shared hit=16
               ->  Hash Join  (cost=0.28..22.02 rows=2 width=6080) (actual time=0.167..0.169 rows=2.00 loops=1)
                     Hash Cond: ((su.unit_type = ('enterprise'::statistical_unit_type)) AND (su.unit_id = ru.unit_id))
                     Buffers: shared hit=14
                     ->  Index Scan using idx_statistical_unit_establishment_id on statistical_unit su  (cost=0.14..21.77 rows=11 width=6080) (actual time=0.005..0.011 rows=11.00 loops=1)
                           Filter: ((valid_from <= '2024-01-01'::date) AND ('2024-01-01'::date < valid_until))
                           Index Searches: 1
                           Buffers: shared hit=10
                     ->  Hash  (cost=0.10..0.10 rows=3 width=8) (actual time=0.152..0.153 rows=2.00 loops=1)
                           Buckets: 1024  Batches: 1  Memory Usage: 9kB
                           Buffers: shared hit=4
                           ->  Append  (cost=0.00..0.10 rows=3 width=8) (actual time=0.148..0.152 rows=2.00 loops=1)
                                 Buffers: shared hit=4
                                 ->  CTE Scan on root_unit ru  (cost=0.00..0.02 rows=1 width=8) (actual time=0.148..0.148 rows=1.00 loops=1)
                                       Storage: Memory  Maximum Storage: 17kB
                                       Buffers: shared hit=4
                                 ->  ProjectSet  (cost=0.00..0.03 rows=1 width=8) (actual time=0.001..0.001 rows=0.00 loops=1)
                                       ->  CTE Scan on root_unit ru_1  (cost=0.00..0.02 rows=1 width=32) (actual time=0.000..0.000 rows=1.00 loops=1)
                                             Storage: Memory  Maximum Storage: 17kB
                                 ->  ProjectSet  (cost=0.00..0.03 rows=1 width=8) (actual time=0.001..0.001 rows=1.00 loops=1)
                                       ->  CTE Scan on root_unit ru_2  (cost=0.00..0.02 rows=1 width=32) (actual time=0.000..0.000 rows=1.00 loops=1)
                                             Storage: Memory  Maximum Storage: 17kB
               ->  Limit  (cost=1.03..1.04 rows=1 width=310) (actual time=0.004..0.004 rows=1.00 loops=2)
                     Buffers: shared hit=2
                     ->  Sort  (cost=1.03..1.04 rows=2 width=310) (actual time=0.004..0.004 rows=1.00 loops=2)
                           Sort Key: eit.priority
                           Sort Method: quicksort  Memory: 25kB
                           Buffers: shared hit=2
                           ->  Seq Scan on external_ident_type eit  (cost=0.00..1.02 rows=2 width=310) (actual time=0.002..0.002 rows=2.00 loops=2)
                                 Buffers: shared hit=2
 Planning:
   Buffers: shared hit=2
 Planning Time: 0.925 ms
 Execution Time: 0.236 ms

