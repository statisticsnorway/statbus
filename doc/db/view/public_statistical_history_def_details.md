```sql
                                           View "public.statistical_history_def"
                  Column                  |         Type          | Collation | Nullable | Default | Storage  | Description 
------------------------------------------+-----------------------+-----------+----------+---------+----------+-------------
 resolution                               | history_resolution    |           |          |         | plain    | 
 year                                     | integer               |           |          |         | plain    | 
 month                                    | integer               |           |          |         | plain    | 
 unit_type                                | statistical_unit_type |           |          |         | plain    | 
 count                                    | bigint                |           |          |         | plain    | 
 births                                   | bigint                |           |          |         | plain    | 
 deaths                                   | bigint                |           |          |         | plain    | 
 name_change_count                        | bigint                |           |          |         | plain    | 
 primary_activity_category_change_count   | bigint                |           |          |         | plain    | 
 secondary_activity_category_change_count | bigint                |           |          |         | plain    | 
 sector_change_count                      | bigint                |           |          |         | plain    | 
 legal_form_change_count                  | bigint                |           |          |         | plain    | 
 physical_region_change_count             | bigint                |           |          |         | plain    | 
 physical_country_change_count            | bigint                |           |          |         | plain    | 
 physical_address_change_count            | bigint                |           |          |         | plain    | 
 stats_summary                            | jsonb                 |           |          |         | extended | 
View definition:
 WITH year_with_unit_basis AS (
         SELECT range.resolution,
            range.year,
            su_curr.unit_type,
            su_curr.unit_id,
            su_prev.unit_id IS NOT NULL AND su_curr.unit_id IS NOT NULL AS track_changes,
            su_curr.birth_date,
            su_curr.death_date,
            COALESCE(range.curr_start <= su_curr.birth_date AND su_curr.birth_date <= range.curr_stop, false) AS born,
            COALESCE(range.curr_start <= su_curr.death_date AND su_curr.death_date <= range.curr_stop, false) AS died,
            su_prev.name AS prev_name,
            su_prev.primary_activity_category_path AS prev_primary_activity_category_path,
            su_prev.secondary_activity_category_path AS prev_secondary_activity_category_path,
            su_prev.sector_path AS prev_sector_path,
            su_prev.legal_form_id AS prev_legal_form_id,
            su_prev.physical_region_path AS prev_physical_region_path,
            su_prev.physical_country_id AS prev_physical_country_id,
            su_prev.physical_address_part1 AS prev_physical_address_part1,
            su_prev.physical_address_part2 AS prev_physical_address_part2,
            su_prev.physical_address_part3 AS prev_physical_address_part3,
            su_curr.name AS curr_name,
            su_curr.primary_activity_category_path AS curr_primary_activity_category_path,
            su_curr.secondary_activity_category_path AS curr_secondary_activity_category_path,
            su_curr.sector_path AS curr_sector_path,
            su_curr.legal_form_id AS curr_legal_form_id,
            su_curr.physical_region_path AS curr_physical_region_path,
            su_curr.physical_country_id AS curr_physical_country_id,
            su_curr.physical_address_part1 AS curr_physical_address_part1,
            su_curr.physical_address_part2 AS curr_physical_address_part2,
            su_curr.physical_address_part3 AS curr_physical_address_part3,
            su_prev.stats AS prev_stats,
            su_curr.stats AS curr_stats,
            su_curr.stats,
            su_curr.stats_summary
           FROM statistical_history_periods range
             JOIN LATERAL ( SELECT range_units.unit_type,
                    range_units.unit_id,
                    range_units.valid_after,
                    range_units.valid_from,
                    range_units.valid_to,
                    range_units.external_idents,
                    range_units.name,
                    range_units.birth_date,
                    range_units.death_date,
                    range_units.search,
                    range_units.primary_activity_category_id,
                    range_units.primary_activity_category_path,
                    range_units.primary_activity_category_code,
                    range_units.secondary_activity_category_id,
                    range_units.secondary_activity_category_path,
                    range_units.secondary_activity_category_code,
                    range_units.activity_category_paths,
                    range_units.sector_id,
                    range_units.sector_path,
                    range_units.sector_code,
                    range_units.sector_name,
                    range_units.data_source_ids,
                    range_units.data_source_codes,
                    range_units.legal_form_id,
                    range_units.legal_form_code,
                    range_units.legal_form_name,
                    range_units.physical_address_part1,
                    range_units.physical_address_part2,
                    range_units.physical_address_part3,
                    range_units.physical_postcode,
                    range_units.physical_postplace,
                    range_units.physical_region_id,
                    range_units.physical_region_path,
                    range_units.physical_region_code,
                    range_units.physical_country_id,
                    range_units.physical_country_iso_2,
                    range_units.physical_latitude,
                    range_units.physical_longitude,
                    range_units.physical_altitude,
                    range_units.postal_address_part1,
                    range_units.postal_address_part2,
                    range_units.postal_address_part3,
                    range_units.postal_postcode,
                    range_units.postal_postplace,
                    range_units.postal_region_id,
                    range_units.postal_region_path,
                    range_units.postal_region_code,
                    range_units.postal_country_id,
                    range_units.postal_country_iso_2,
                    range_units.postal_latitude,
                    range_units.postal_longitude,
                    range_units.postal_altitude,
                    range_units.web_address,
                    range_units.email_address,
                    range_units.phone_number,
                    range_units.landline,
                    range_units.mobile_number,
                    range_units.fax_number,
                    range_units.status_id,
                    range_units.status_code,
                    range_units.include_unit_in_reports,
                    range_units.invalid_codes,
                    range_units.has_legal_unit,
                    range_units.establishment_ids,
                    range_units.legal_unit_ids,
                    range_units.enterprise_ids,
                    range_units.stats,
                    range_units.stats_summary,
                    range_units.establishment_count,
                    range_units.legal_unit_count,
                    range_units.enterprise_count,
                    range_units.tag_paths,
                    range_units.last_in_range
                   FROM ( SELECT su_range.unit_type,
                            su_range.unit_id,
                            su_range.valid_after,
                            su_range.valid_from,
                            su_range.valid_to,
                            su_range.external_idents,
                            su_range.name,
                            su_range.birth_date,
                            su_range.death_date,
                            su_range.search,
                            su_range.primary_activity_category_id,
                            su_range.primary_activity_category_path,
                            su_range.primary_activity_category_code,
                            su_range.secondary_activity_category_id,
                            su_range.secondary_activity_category_path,
                            su_range.secondary_activity_category_code,
                            su_range.activity_category_paths,
                            su_range.sector_id,
                            su_range.sector_path,
                            su_range.sector_code,
                            su_range.sector_name,
                            su_range.data_source_ids,
                            su_range.data_source_codes,
                            su_range.legal_form_id,
                            su_range.legal_form_code,
                            su_range.legal_form_name,
                            su_range.physical_address_part1,
                            su_range.physical_address_part2,
                            su_range.physical_address_part3,
                            su_range.physical_postcode,
                            su_range.physical_postplace,
                            su_range.physical_region_id,
                            su_range.physical_region_path,
                            su_range.physical_region_code,
                            su_range.physical_country_id,
                            su_range.physical_country_iso_2,
                            su_range.physical_latitude,
                            su_range.physical_longitude,
                            su_range.physical_altitude,
                            su_range.postal_address_part1,
                            su_range.postal_address_part2,
                            su_range.postal_address_part3,
                            su_range.postal_postcode,
                            su_range.postal_postplace,
                            su_range.postal_region_id,
                            su_range.postal_region_path,
                            su_range.postal_region_code,
                            su_range.postal_country_id,
                            su_range.postal_country_iso_2,
                            su_range.postal_latitude,
                            su_range.postal_longitude,
                            su_range.postal_altitude,
                            su_range.web_address,
                            su_range.email_address,
                            su_range.phone_number,
                            su_range.landline,
                            su_range.mobile_number,
                            su_range.fax_number,
                            su_range.status_id,
                            su_range.status_code,
                            su_range.include_unit_in_reports,
                            su_range.invalid_codes,
                            su_range.has_legal_unit,
                            su_range.establishment_ids,
                            su_range.legal_unit_ids,
                            su_range.enterprise_ids,
                            su_range.stats,
                            su_range.stats_summary,
                            su_range.establishment_count,
                            su_range.legal_unit_count,
                            su_range.enterprise_count,
                            su_range.tag_paths,
                            row_number() OVER (PARTITION BY su_range.unit_type, su_range.unit_id ORDER BY su_range.valid_from DESC) = 1 AS last_in_range
                           FROM statistical_unit su_range
                          WHERE daterange(su_range.valid_from, su_range.valid_to, '[]'::text) && daterange(range.curr_start, range.curr_stop, '[]'::text) AND (su_range.death_date IS NULL OR range.curr_start <= su_range.death_date) AND (su_range.birth_date IS NULL OR su_range.birth_date <= range.curr_stop) AND su_range.include_unit_in_reports) range_units
                  WHERE range_units.last_in_range) su_curr ON true
             LEFT JOIN statistical_unit su_prev ON su_prev.valid_from <= range.prev_stop AND range.prev_stop <= su_prev.valid_to AND su_prev.unit_type = su_curr.unit_type AND su_prev.unit_id = su_curr.unit_id AND su_prev.include_unit_in_reports
          WHERE range.resolution = 'year'::history_resolution
        ), year_with_unit_derived AS (
         SELECT basis.resolution,
            basis.year,
            basis.unit_type,
            basis.unit_id,
            basis.track_changes,
            basis.birth_date,
            basis.death_date,
            basis.born,
            basis.died,
            basis.prev_name,
            basis.prev_primary_activity_category_path,
            basis.prev_secondary_activity_category_path,
            basis.prev_sector_path,
            basis.prev_legal_form_id,
            basis.prev_physical_region_path,
            basis.prev_physical_country_id,
            basis.prev_physical_address_part1,
            basis.prev_physical_address_part2,
            basis.prev_physical_address_part3,
            basis.curr_name,
            basis.curr_primary_activity_category_path,
            basis.curr_secondary_activity_category_path,
            basis.curr_sector_path,
            basis.curr_legal_form_id,
            basis.curr_physical_region_path,
            basis.curr_physical_country_id,
            basis.curr_physical_address_part1,
            basis.curr_physical_address_part2,
            basis.curr_physical_address_part3,
            basis.prev_stats,
            basis.curr_stats,
            basis.stats,
            basis.stats_summary,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_name::text IS DISTINCT FROM basis.curr_name::text AS name_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_primary_activity_category_path IS DISTINCT FROM basis.curr_primary_activity_category_path AS primary_activity_category_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_secondary_activity_category_path IS DISTINCT FROM basis.curr_secondary_activity_category_path AS secondary_activity_category_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_sector_path IS DISTINCT FROM basis.curr_sector_path AS sector_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_legal_form_id IS DISTINCT FROM basis.curr_legal_form_id AS legal_form_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_physical_region_path IS DISTINCT FROM basis.curr_physical_region_path AS physical_region_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_physical_country_id IS DISTINCT FROM basis.curr_physical_country_id AS physical_country_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND (basis.prev_physical_address_part1::text IS DISTINCT FROM basis.curr_physical_address_part1::text OR basis.prev_physical_address_part2::text IS DISTINCT FROM basis.curr_physical_address_part2::text OR basis.prev_physical_address_part3::text IS DISTINCT FROM basis.curr_physical_address_part3::text) AS physical_address_changed
           FROM year_with_unit_basis basis
        ), year_and_month_with_unit_basis AS (
         SELECT range.resolution,
            range.year,
            range.month,
            su_curr.unit_type,
            su_curr.unit_id,
            su_prev.unit_id IS NOT NULL AND su_curr.unit_id IS NOT NULL AS track_changes,
            su_curr.birth_date,
            su_curr.death_date,
            COALESCE(range.curr_start <= su_curr.birth_date AND su_curr.birth_date <= range.curr_stop, false) AS born,
            COALESCE(range.curr_start <= su_curr.death_date AND su_curr.death_date <= range.curr_stop, false) AS died,
            su_prev.name AS prev_name,
            su_prev.primary_activity_category_path AS prev_primary_activity_category_path,
            su_prev.secondary_activity_category_path AS prev_secondary_activity_category_path,
            su_prev.sector_path AS prev_sector_path,
            su_prev.legal_form_id AS prev_legal_form_id,
            su_prev.physical_region_path AS prev_physical_region_path,
            su_prev.physical_country_id AS prev_physical_country_id,
            su_prev.physical_address_part1 AS prev_physical_address_part1,
            su_prev.physical_address_part2 AS prev_physical_address_part2,
            su_prev.physical_address_part3 AS prev_physical_address_part3,
            su_curr.name AS curr_name,
            su_curr.primary_activity_category_path AS curr_primary_activity_category_path,
            su_curr.secondary_activity_category_path AS curr_secondary_activity_category_path,
            su_curr.sector_path AS curr_sector_path,
            su_curr.legal_form_id AS curr_legal_form_id,
            su_curr.physical_region_path AS curr_physical_region_path,
            su_curr.physical_country_id AS curr_physical_country_id,
            su_curr.physical_address_part1 AS curr_physical_address_part1,
            su_curr.physical_address_part2 AS curr_physical_address_part2,
            su_curr.physical_address_part3 AS curr_physical_address_part3,
            su_prev.stats AS start_stats,
            su_curr.stats AS stop_stats,
            su_curr.stats,
            su_curr.stats_summary
           FROM statistical_history_periods range
             JOIN LATERAL ( SELECT range_units.unit_type,
                    range_units.unit_id,
                    range_units.valid_after,
                    range_units.valid_from,
                    range_units.valid_to,
                    range_units.external_idents,
                    range_units.name,
                    range_units.birth_date,
                    range_units.death_date,
                    range_units.search,
                    range_units.primary_activity_category_id,
                    range_units.primary_activity_category_path,
                    range_units.primary_activity_category_code,
                    range_units.secondary_activity_category_id,
                    range_units.secondary_activity_category_path,
                    range_units.secondary_activity_category_code,
                    range_units.activity_category_paths,
                    range_units.sector_id,
                    range_units.sector_path,
                    range_units.sector_code,
                    range_units.sector_name,
                    range_units.data_source_ids,
                    range_units.data_source_codes,
                    range_units.legal_form_id,
                    range_units.legal_form_code,
                    range_units.legal_form_name,
                    range_units.physical_address_part1,
                    range_units.physical_address_part2,
                    range_units.physical_address_part3,
                    range_units.physical_postcode,
                    range_units.physical_postplace,
                    range_units.physical_region_id,
                    range_units.physical_region_path,
                    range_units.physical_region_code,
                    range_units.physical_country_id,
                    range_units.physical_country_iso_2,
                    range_units.physical_latitude,
                    range_units.physical_longitude,
                    range_units.physical_altitude,
                    range_units.postal_address_part1,
                    range_units.postal_address_part2,
                    range_units.postal_address_part3,
                    range_units.postal_postcode,
                    range_units.postal_postplace,
                    range_units.postal_region_id,
                    range_units.postal_region_path,
                    range_units.postal_region_code,
                    range_units.postal_country_id,
                    range_units.postal_country_iso_2,
                    range_units.postal_latitude,
                    range_units.postal_longitude,
                    range_units.postal_altitude,
                    range_units.web_address,
                    range_units.email_address,
                    range_units.phone_number,
                    range_units.landline,
                    range_units.mobile_number,
                    range_units.fax_number,
                    range_units.status_id,
                    range_units.status_code,
                    range_units.include_unit_in_reports,
                    range_units.invalid_codes,
                    range_units.has_legal_unit,
                    range_units.establishment_ids,
                    range_units.legal_unit_ids,
                    range_units.enterprise_ids,
                    range_units.stats,
                    range_units.stats_summary,
                    range_units.establishment_count,
                    range_units.legal_unit_count,
                    range_units.enterprise_count,
                    range_units.tag_paths,
                    range_units.last_in_range
                   FROM ( SELECT su_range.unit_type,
                            su_range.unit_id,
                            su_range.valid_after,
                            su_range.valid_from,
                            su_range.valid_to,
                            su_range.external_idents,
                            su_range.name,
                            su_range.birth_date,
                            su_range.death_date,
                            su_range.search,
                            su_range.primary_activity_category_id,
                            su_range.primary_activity_category_path,
                            su_range.primary_activity_category_code,
                            su_range.secondary_activity_category_id,
                            su_range.secondary_activity_category_path,
                            su_range.secondary_activity_category_code,
                            su_range.activity_category_paths,
                            su_range.sector_id,
                            su_range.sector_path,
                            su_range.sector_code,
                            su_range.sector_name,
                            su_range.data_source_ids,
                            su_range.data_source_codes,
                            su_range.legal_form_id,
                            su_range.legal_form_code,
                            su_range.legal_form_name,
                            su_range.physical_address_part1,
                            su_range.physical_address_part2,
                            su_range.physical_address_part3,
                            su_range.physical_postcode,
                            su_range.physical_postplace,
                            su_range.physical_region_id,
                            su_range.physical_region_path,
                            su_range.physical_region_code,
                            su_range.physical_country_id,
                            su_range.physical_country_iso_2,
                            su_range.physical_latitude,
                            su_range.physical_longitude,
                            su_range.physical_altitude,
                            su_range.postal_address_part1,
                            su_range.postal_address_part2,
                            su_range.postal_address_part3,
                            su_range.postal_postcode,
                            su_range.postal_postplace,
                            su_range.postal_region_id,
                            su_range.postal_region_path,
                            su_range.postal_region_code,
                            su_range.postal_country_id,
                            su_range.postal_country_iso_2,
                            su_range.postal_latitude,
                            su_range.postal_longitude,
                            su_range.postal_altitude,
                            su_range.web_address,
                            su_range.email_address,
                            su_range.phone_number,
                            su_range.landline,
                            su_range.mobile_number,
                            su_range.fax_number,
                            su_range.status_id,
                            su_range.status_code,
                            su_range.include_unit_in_reports,
                            su_range.invalid_codes,
                            su_range.has_legal_unit,
                            su_range.establishment_ids,
                            su_range.legal_unit_ids,
                            su_range.enterprise_ids,
                            su_range.stats,
                            su_range.stats_summary,
                            su_range.establishment_count,
                            su_range.legal_unit_count,
                            su_range.enterprise_count,
                            su_range.tag_paths,
                            row_number() OVER (PARTITION BY su_range.unit_type, su_range.unit_id ORDER BY su_range.valid_from DESC) = 1 AS last_in_range
                           FROM statistical_unit su_range
                          WHERE daterange(su_range.valid_from, su_range.valid_to, '[]'::text) && daterange(range.curr_start, range.curr_stop, '[]'::text) AND (su_range.death_date IS NULL OR range.curr_start <= su_range.death_date) AND (su_range.birth_date IS NULL OR su_range.birth_date <= range.curr_stop) AND su_range.include_unit_in_reports) range_units
                  WHERE range_units.last_in_range) su_curr ON true
             LEFT JOIN statistical_unit su_prev ON su_prev.valid_from <= range.prev_stop AND range.prev_stop <= su_prev.valid_to AND su_prev.unit_type = su_curr.unit_type AND su_prev.unit_id = su_curr.unit_id AND su_prev.include_unit_in_reports
          WHERE range.resolution = 'year-month'::history_resolution
        ), year_and_month_with_unit_derived AS (
         SELECT basis.resolution,
            basis.year,
            basis.month,
            basis.unit_type,
            basis.unit_id,
            basis.track_changes,
            basis.birth_date,
            basis.death_date,
            basis.born,
            basis.died,
            basis.prev_name,
            basis.prev_primary_activity_category_path,
            basis.prev_secondary_activity_category_path,
            basis.prev_sector_path,
            basis.prev_legal_form_id,
            basis.prev_physical_region_path,
            basis.prev_physical_country_id,
            basis.prev_physical_address_part1,
            basis.prev_physical_address_part2,
            basis.prev_physical_address_part3,
            basis.curr_name,
            basis.curr_primary_activity_category_path,
            basis.curr_secondary_activity_category_path,
            basis.curr_sector_path,
            basis.curr_legal_form_id,
            basis.curr_physical_region_path,
            basis.curr_physical_country_id,
            basis.curr_physical_address_part1,
            basis.curr_physical_address_part2,
            basis.curr_physical_address_part3,
            basis.start_stats,
            basis.stop_stats,
            basis.stats,
            basis.stats_summary,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_name::text IS DISTINCT FROM basis.curr_name::text AS name_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_primary_activity_category_path IS DISTINCT FROM basis.curr_primary_activity_category_path AS primary_activity_category_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_secondary_activity_category_path IS DISTINCT FROM basis.curr_secondary_activity_category_path AS secondary_activity_category_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_sector_path IS DISTINCT FROM basis.curr_sector_path AS sector_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_legal_form_id IS DISTINCT FROM basis.curr_legal_form_id AS legal_form_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_physical_region_path IS DISTINCT FROM basis.curr_physical_region_path AS physical_region_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND basis.prev_physical_country_id IS DISTINCT FROM basis.curr_physical_country_id AS physical_country_changed,
            basis.track_changes AND NOT basis.born AND NOT basis.died AND (basis.prev_physical_address_part1::text IS DISTINCT FROM basis.curr_physical_address_part1::text OR basis.prev_physical_address_part2::text IS DISTINCT FROM basis.curr_physical_address_part2::text OR basis.prev_physical_address_part3::text IS DISTINCT FROM basis.curr_physical_address_part3::text) AS physical_address_changed
           FROM year_and_month_with_unit_basis basis
        ), year_with_unit AS (
         SELECT source.resolution,
            source.year,
            NULL::integer AS month,
            source.unit_type,
            count(source.*) FILTER (WHERE NOT source.died) AS count,
            count(source.*) FILTER (WHERE source.born) AS births,
            count(source.*) FILTER (WHERE source.died) AS deaths,
            count(source.*) FILTER (WHERE source.name_changed) AS name_change_count,
            count(source.*) FILTER (WHERE source.primary_activity_category_changed) AS primary_activity_category_change_count,
            count(source.*) FILTER (WHERE source.secondary_activity_category_changed) AS secondary_activity_category_change_count,
            count(source.*) FILTER (WHERE source.sector_changed) AS sector_change_count,
            count(source.*) FILTER (WHERE source.legal_form_changed) AS legal_form_change_count,
            count(source.*) FILTER (WHERE source.physical_region_changed) AS physical_region_change_count,
            count(source.*) FILTER (WHERE source.physical_country_changed) AS physical_country_change_count,
            count(source.*) FILTER (WHERE source.physical_address_changed) AS physical_address_change_count,
            jsonb_stats_summary_merge_agg(source.stats_summary) AS stats_summary
           FROM year_with_unit_derived source
          GROUP BY source.resolution, source.year, source.unit_type
        ), year_and_month_with_unit AS (
         SELECT source.resolution,
            source.year,
            source.month,
            source.unit_type,
            count(source.*) FILTER (WHERE NOT source.died) AS count,
            count(source.*) FILTER (WHERE source.born) AS births,
            count(source.*) FILTER (WHERE source.died) AS deaths,
            count(source.*) FILTER (WHERE source.name_changed) AS name_change_count,
            count(source.*) FILTER (WHERE source.primary_activity_category_changed) AS primary_activity_category_change_count,
            count(source.*) FILTER (WHERE source.secondary_activity_category_changed) AS secondary_activity_category_change_count,
            count(source.*) FILTER (WHERE source.sector_changed) AS sector_change_count,
            count(source.*) FILTER (WHERE source.legal_form_changed) AS legal_form_change_count,
            count(source.*) FILTER (WHERE source.physical_region_changed) AS physical_region_change_count,
            count(source.*) FILTER (WHERE source.physical_country_changed) AS physical_country_change_count,
            count(source.*) FILTER (WHERE source.physical_address_changed) AS physical_address_change_count,
            jsonb_stats_summary_merge_agg(source.stats_summary) AS stats_summary
           FROM year_and_month_with_unit_derived source
          GROUP BY source.resolution, source.year, source.month, source.unit_type
        )
 SELECT year_with_unit.resolution,
    year_with_unit.year,
    year_with_unit.month,
    year_with_unit.unit_type,
    year_with_unit.count,
    year_with_unit.births,
    year_with_unit.deaths,
    year_with_unit.name_change_count,
    year_with_unit.primary_activity_category_change_count,
    year_with_unit.secondary_activity_category_change_count,
    year_with_unit.sector_change_count,
    year_with_unit.legal_form_change_count,
    year_with_unit.physical_region_change_count,
    year_with_unit.physical_country_change_count,
    year_with_unit.physical_address_change_count,
    year_with_unit.stats_summary
   FROM year_with_unit
UNION ALL
 SELECT year_and_month_with_unit.resolution,
    year_and_month_with_unit.year,
    year_and_month_with_unit.month,
    year_and_month_with_unit.unit_type,
    year_and_month_with_unit.count,
    year_and_month_with_unit.births,
    year_and_month_with_unit.deaths,
    year_and_month_with_unit.name_change_count,
    year_and_month_with_unit.primary_activity_category_change_count,
    year_and_month_with_unit.secondary_activity_category_change_count,
    year_and_month_with_unit.sector_change_count,
    year_and_month_with_unit.legal_form_change_count,
    year_and_month_with_unit.physical_region_change_count,
    year_and_month_with_unit.physical_country_change_count,
    year_and_month_with_unit.physical_address_change_count,
    year_and_month_with_unit.stats_summary
   FROM year_and_month_with_unit;

```
