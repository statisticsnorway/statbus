# StatBus Security Posture

This document is automatically generated by `test/sql/008_verify_rls_and_grants.sql`. Do not edit it manually.

## Database Roles

| Role | Purpose |
|------|---------|
| `postgres` | Superuser, owns all objects |
| `authenticator` | PostgREST connects as this role, then switches via JWT |
| `anon` | Unauthenticated requests (very limited access) |
| `authenticated` | Base role for all logged-in users (SELECT on most tables) |
| `regular_user` | Standard user — can read most tables, edit core business data |
| `restricted_user` | User with region/activity restrictions applied via RLS |
| `admin_user` | Full access to all tables |
| `super_user` | Administrative operations |
| `notify_reader` | Can read notifications (used by worker) |

## Row Level Security (RLS)

All public tables must have RLS enabled. RLS policies control which rows
each role can see and modify.

### Public Tables

- **`activity`** — RLS ON
  - Policies: `activity_admin_user_manage` (ALL → admin_user), `activity_authenticated_read` (SELECT → authenticated), `activity_regular_user_manage` (ALL → regular_user), `restricted_user_activity_access` (ALL → restricted_user)
- **`activity_category`** — RLS ON
  - Policies: `activity_category_admin_user_manage` (ALL → admin_user), `activity_category_authenticated_read` (SELECT → authenticated), `activity_category_regular_user_read` (SELECT → regular_user)
- **`activity_category_access`** — RLS ON
  - Policies: `activity_category_access_admin_policy` (ALL → admin_user), `activity_category_access_read_policy` (SELECT → authenticated)
- **`activity_category_standard`** — RLS ON
  - Policies: `activity_category_standard_admin_user_manage` (ALL → admin_user), `activity_category_standard_authenticated_read` (SELECT → authenticated), `activity_category_standard_regular_user_read` (SELECT → regular_user)
- **`activity_category_used`** — RLS ON
  - Policies: `activity_category_used_admin_user_manage` (ALL → admin_user), `activity_category_used_authenticated_read` (SELECT → authenticated), `activity_category_used_regular_user_read` (SELECT → regular_user)
- **`contact`** — RLS ON
  - Policies: `contact_admin_user_manage` (ALL → admin_user), `contact_authenticated_read` (SELECT → authenticated), `contact_regular_user_manage` (ALL → regular_user)
- **`country`** — RLS ON
  - Policies: `country_admin_user_manage` (ALL → admin_user), `country_authenticated_read` (SELECT → authenticated), `country_regular_user_read` (SELECT → regular_user)
- **`country_used`** — RLS ON
  - Policies: `country_used_admin_user_manage` (ALL → admin_user), `country_used_authenticated_read` (SELECT → authenticated), `country_used_regular_user_read` (SELECT → regular_user)
- **`data_source`** — RLS ON
  - Policies: `data_source_admin_user_manage` (ALL → admin_user), `data_source_authenticated_read` (SELECT → authenticated), `data_source_regular_user_read` (SELECT → regular_user)
- **`data_source_used`** — RLS ON
  - Policies: `data_source_used_admin_user_manage` (ALL → admin_user), `data_source_used_authenticated_read` (SELECT → authenticated), `data_source_used_regular_user_read` (SELECT → regular_user)
- **`enterprise`** — RLS ON
  - Policies: `enterprise_admin_user_manage` (ALL → admin_user), `enterprise_authenticated_read` (SELECT → authenticated), `enterprise_regular_user_manage` (ALL → regular_user)
- **`enterprise_group`** — RLS ON
  - Policies: `enterprise_group_admin_user_manage` (ALL → admin_user), `enterprise_group_authenticated_read` (SELECT → authenticated), `enterprise_group_regular_user_manage` (ALL → regular_user)
- **`enterprise_group_role`** — RLS ON
  - Policies: `enterprise_group_role_admin_user_manage` (ALL → admin_user), `enterprise_group_role_authenticated_read` (SELECT → authenticated), `enterprise_group_role_regular_user_read` (SELECT → regular_user)
- **`enterprise_group_type`** — RLS ON
  - Policies: `enterprise_group_type_admin_user_manage` (ALL → admin_user), `enterprise_group_type_authenticated_read` (SELECT → authenticated), `enterprise_group_type_regular_user_read` (SELECT → regular_user)
- **`establishment`** — RLS ON
  - Policies: `establishment_admin_user_manage` (ALL → admin_user), `establishment_authenticated_read` (SELECT → authenticated), `establishment_regular_user_manage` (ALL → regular_user)
- **`external_ident`** — RLS ON
  - Policies: `external_ident_admin_user_manage` (ALL → admin_user), `external_ident_authenticated_read` (SELECT → authenticated), `external_ident_regular_user_manage` (ALL → regular_user)
- **`external_ident_type`** — RLS ON
  - Policies: `external_ident_type_admin_user_manage` (ALL → admin_user), `external_ident_type_authenticated_read` (SELECT → authenticated), `external_ident_type_regular_user_read` (SELECT → regular_user)
- **`foreign_participation`** — RLS ON
  - Policies: `foreign_participation_admin_user_manage` (ALL → admin_user), `foreign_participation_authenticated_read` (SELECT → authenticated), `foreign_participation_regular_user_read` (SELECT → regular_user)
- **`image`** — RLS ON
  - Policies: `image_admin_user_manage` (ALL → admin_user), `image_authenticated_read` (SELECT → authenticated), `image_regular_user_manage` (ALL → regular_user)
- **`import_data_column`** — RLS ON
  - Policies: `import_data_column_admin_user_manage` (ALL → admin_user), `import_data_column_authenticated_read` (SELECT → authenticated), `import_data_column_regular_user_read` (SELECT → regular_user)
- **`import_definition`** — RLS ON
  - Policies: `import_definition_admin_user_manage` (ALL → admin_user), `import_definition_authenticated_read` (SELECT → authenticated), `import_definition_regular_user_read` (SELECT → regular_user)
- **`import_definition_step`** — RLS ON
  - Policies: `import_definition_step_admin_user_manage` (ALL → admin_user), `import_definition_step_authenticated_read` (SELECT → authenticated), `import_definition_step_regular_user_read` (SELECT → regular_user)
- **`import_job`** — RLS ON
  - Policies: `import_job_admin_user_manage` (ALL → admin_user), `import_job_authenticated_select_all` (SELECT → authenticated), `import_job_notify_reader_select_all` (SELECT → notify_reader), `import_job_regular_user_delete_own` (DELETE → regular_user), `import_job_regular_user_insert_own` (INSERT → regular_user), `import_job_regular_user_update_own` (UPDATE → regular_user)
- **`import_mapping`** — RLS ON
  - Policies: `import_mapping_admin_user_manage` (ALL → admin_user), `import_mapping_authenticated_read` (SELECT → authenticated), `import_mapping_regular_user_read` (SELECT → regular_user)
- **`import_source_column`** — RLS ON
  - Policies: `import_source_column_admin_user_manage` (ALL → admin_user), `import_source_column_authenticated_read` (SELECT → authenticated), `import_source_column_regular_user_read` (SELECT → regular_user)
- **`import_step`** — RLS ON
  - Policies: `import_step_admin_user_manage` (ALL → admin_user), `import_step_authenticated_read` (SELECT → authenticated), `import_step_regular_user_read` (SELECT → regular_user)
- **`legal_form`** — RLS ON
  - Policies: `legal_form_admin_user_manage` (ALL → admin_user), `legal_form_authenticated_read` (SELECT → authenticated), `legal_form_regular_user_read` (SELECT → regular_user)
- **`legal_form_used`** — RLS ON
  - Policies: `legal_form_used_admin_user_manage` (ALL → admin_user), `legal_form_used_authenticated_read` (SELECT → authenticated), `legal_form_used_regular_user_read` (SELECT → regular_user)
- **`legal_unit`** — RLS ON
  - Policies: `legal_unit_admin_user_manage` (ALL → admin_user), `legal_unit_authenticated_read` (SELECT → authenticated), `legal_unit_regular_user_manage` (ALL → regular_user)
- **`location`** — RLS ON
  - Policies: `location_admin_user_manage` (ALL → admin_user), `location_authenticated_read` (SELECT → authenticated), `location_regular_user_manage` (ALL → regular_user), `restricted_user_location_access` (ALL → restricted_user)
- **`person`** — RLS ON
  - Policies: `person_admin_user_manage` (ALL → admin_user), `person_authenticated_read` (SELECT → authenticated), `person_regular_user_manage` (ALL → regular_user)
- **`person_for_unit`** — RLS ON
  - Policies: `person_for_unit_admin_user_manage` (ALL → admin_user), `person_for_unit_authenticated_read` (SELECT → authenticated), `person_for_unit_regular_user_manage` (ALL → regular_user)
- **`person_role`** — RLS ON
  - Policies: `person_role_admin_user_manage` (ALL → admin_user), `person_role_authenticated_read` (SELECT → authenticated), `person_role_regular_user_read` (SELECT → regular_user)
- **`region`** — RLS ON
  - Policies: `region_admin_user_manage` (ALL → admin_user), `region_authenticated_read` (SELECT → authenticated), `region_regular_user_read` (SELECT → regular_user)
- **`region_access`** — RLS ON
  - Policies: `region_access_admin_policy` (ALL → admin_user), `region_access_read_policy` (SELECT → authenticated)
- **`region_used`** — RLS ON
  - Policies: `region_used_admin_user_manage` (ALL → admin_user), `region_used_authenticated_read` (SELECT → authenticated), `region_used_regular_user_read` (SELECT → regular_user)
- **`relative_period`** — RLS ON
  - Policies: `relative_period_admin_user_manage` (ALL → admin_user), `relative_period_authenticated_read` (SELECT → authenticated), `relative_period_regular_user_read` (SELECT → regular_user)
- **`reorg_type`** — RLS ON
  - Policies: `reorg_type_admin_user_manage` (ALL → admin_user), `reorg_type_authenticated_read` (SELECT → authenticated), `reorg_type_regular_user_read` (SELECT → regular_user)
- **`sector`** — RLS ON
  - Policies: `sector_admin_user_manage` (ALL → admin_user), `sector_authenticated_read` (SELECT → authenticated), `sector_regular_user_read` (SELECT → regular_user)
- **`sector_used`** — RLS ON
  - Policies: `sector_used_admin_user_manage` (ALL → admin_user), `sector_used_authenticated_read` (SELECT → authenticated), `sector_used_regular_user_read` (SELECT → regular_user)
- **`settings`** — RLS ON
  - Policies: `settings_admin_user_manage` (ALL → admin_user), `settings_authenticated_read` (SELECT → authenticated), `settings_regular_user_read` (SELECT → regular_user)
- **`stat_definition`** — RLS ON
  - Policies: `stat_definition_admin_user_manage` (ALL → admin_user), `stat_definition_authenticated_read` (SELECT → authenticated), `stat_definition_regular_user_read` (SELECT → regular_user)
- **`stat_for_unit`** — RLS ON
  - Policies: `stat_for_unit_admin_user_manage` (ALL → admin_user), `stat_for_unit_authenticated_read` (SELECT → authenticated), `stat_for_unit_regular_user_manage` (ALL → regular_user)
- **`statistical_history`** — RLS ON
  - Policies: `statistical_history_admin_user_manage` (ALL → admin_user), `statistical_history_authenticated_read` (SELECT → authenticated), `statistical_history_regular_user_read` (SELECT → regular_user)
- **`statistical_history_facet`** — RLS ON
  - Policies: `statistical_history_facet_admin_user_manage` (ALL → admin_user), `statistical_history_facet_authenticated_read` (SELECT → authenticated), `statistical_history_facet_regular_user_read` (SELECT → regular_user)
- **`statistical_history_facet_partitions`** — RLS OFF (exempt: internal staging table)
- **`statistical_unit`** — RLS ON
  - Policies: `statistical_unit_admin_user_manage` (ALL → admin_user), `statistical_unit_authenticated_read` (SELECT → authenticated), `statistical_unit_regular_user_read` (SELECT → regular_user)
- **`statistical_unit_facet`** — RLS ON
  - Policies: `statistical_unit_facet_admin_user_manage` (ALL → admin_user), `statistical_unit_facet_authenticated_read` (SELECT → authenticated), `statistical_unit_facet_regular_user_read` (SELECT → regular_user)
- **`statistical_unit_facet_dirty_partitions`** — RLS OFF (exempt: internal staging table)
- **`statistical_unit_facet_staging`** — RLS OFF (exempt: internal staging table)
- **`statistical_unit_staging`** — RLS OFF (exempt: internal staging table)
- **`status`** — RLS ON
  - Policies: `status_admin_user_manage` (ALL → admin_user), `status_authenticated_read` (SELECT → authenticated), `status_regular_user_read` (SELECT → regular_user)
- **`tag`** — RLS ON
  - Policies: `tag_admin_user_manage` (ALL → admin_user), `tag_authenticated_read` (SELECT → authenticated), `tag_regular_user_read` (SELECT → regular_user)
- **`tag_for_unit`** — RLS ON
  - Policies: `tag_for_unit_admin_user_manage` (ALL → admin_user), `tag_for_unit_authenticated_read` (SELECT → authenticated), `tag_for_unit_regular_user_manage` (ALL → regular_user)
- **`timeline_enterprise`** — RLS ON
  - Policies: `timeline_enterprise_admin_user_manage` (ALL → admin_user), `timeline_enterprise_authenticated_read` (SELECT → authenticated), `timeline_enterprise_regular_user_read` (SELECT → regular_user)
- **`timeline_establishment`** — RLS ON
  - Policies: `timeline_establishment_admin_user_manage` (ALL → admin_user), `timeline_establishment_authenticated_read` (SELECT → authenticated), `timeline_establishment_regular_user_read` (SELECT → regular_user)
- **`timeline_legal_unit`** — RLS ON
  - Policies: `timeline_legal_unit_admin_user_manage` (ALL → admin_user), `timeline_legal_unit_authenticated_read` (SELECT → authenticated), `timeline_legal_unit_regular_user_read` (SELECT → regular_user)
- **`timepoints`** — RLS ON
  - Policies: `timepoints_admin_user_manage` (ALL → admin_user), `timepoints_authenticated_read` (SELECT → authenticated), `timepoints_regular_user_read` (SELECT → regular_user)
- **`timesegments`** — RLS ON
  - Policies: `timesegments_admin_user_manage` (ALL → admin_user), `timesegments_authenticated_read` (SELECT → authenticated), `timesegments_regular_user_read` (SELECT → regular_user)
- **`timesegments_years`** — RLS ON
  - Policies: `timesegments_years_admin_user_manage` (ALL → admin_user), `timesegments_years_authenticated_read` (SELECT → authenticated), `timesegments_years_regular_user_read` (SELECT → regular_user)
- **`unit_notes`** — RLS ON
  - Policies: `unit_notes_admin_user_manage` (ALL → admin_user), `unit_notes_authenticated_read` (SELECT → authenticated), `unit_notes_regular_user_manage` (ALL → regular_user)
- **`unit_size`** — RLS ON
  - Policies: `unit_size_admin_user_manage` (ALL → admin_user), `unit_size_authenticated_read` (SELECT → authenticated), `unit_size_regular_user_read` (SELECT → regular_user)

### Non-Public Schema Tables with RLS

- **`auth.api_key`** — RLS ON
  - Policies: `delete_own_api_keys` (DELETE → PUBLIC), `insert_own_api_keys` (INSERT → PUBLIC), `revoke_own_api_keys` (UPDATE → PUBLIC), `select_own_api_keys` (SELECT → PUBLIC)
- **`auth.refresh_session`** — RLS ON
  - Policies: `admin_all_refresh_sessions` (ALL → PUBLIC), `delete_own_refresh_sessions` (DELETE → PUBLIC), `insert_own_refresh_sessions` (INSERT → PUBLIC), `select_own_refresh_sessions` (SELECT → PUBLIC), `update_own_refresh_sessions` (UPDATE → PUBLIC)
- **`auth.secrets`** — RLS ON
- **`auth.user`** — RLS ON
  - Policies: `admin_all_access` (ALL → PUBLIC), `select_own_user` (SELECT → PUBLIC), `update_own_user` (UPDATE → PUBLIC)
- **`db.migration`** — RLS ON
  - Policies: `migration_authenticated_read` (SELECT → authenticated)

## View Grants

Public views (excluding `*__for_portion_of_valid`) must have SELECT and INSERT
granted to `authenticated`, `regular_user`, and `admin_user`.

- **`activity_category_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`activity_category_available_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`activity_category_isic_v4`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`activity_category_nace_v2_1`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`activity_category_used_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`api_key`**: admin_user: INSERT, SELECT; authenticated: DELETE, INSERT, SELECT; regular_user: INSERT, SELECT
- **`country_used_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`country_view`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`data_source_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`data_source_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`data_source_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`data_source_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`data_source_used_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_external_idents`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_group_role_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_group_role_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_group_role_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_group_role_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_group_type_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_group_type_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_group_type_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`enterprise_group_type_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`external_ident_type_active`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`external_ident_type_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`foreign_participation_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`foreign_participation_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`foreign_participation_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`foreign_participation_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`hypopg_hidden_indexes`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`hypopg_list_indexes`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`legal_form_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`legal_form_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`legal_form_custom_only`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`legal_form_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`legal_form_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`legal_form_used_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`person_role_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`person_role_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`person_role_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`person_role_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`pg_stat_monitor`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`pg_stat_statements`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`pg_stat_statements_info`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`region_upload`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`region_used_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`relative_period_with_time`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`reorg_type_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`reorg_type_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`reorg_type_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`reorg_type_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`sector_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`sector_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`sector_custom_only`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`sector_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`sector_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`sector_used_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`stat_definition_active`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`stat_definition_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`statistical_unit_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`statistical_unit_facet_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`time_context`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`timeline_enterprise_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`timeline_establishment_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`timeline_legal_unit_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`timesegments_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`timesegments_years_def`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`unit_size_available`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`unit_size_custom`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`unit_size_ordered`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`unit_size_system`**: admin_user: INSERT, SELECT; authenticated: INSERT, SELECT; regular_user: INSERT, SELECT
- **`user`**: authenticated: SELECT

## SECURITY DEFINER Functions

Functions that bypass RLS by executing as the function owner. Each must be
registered in the test with justification.

### Authentication & Sessions

Access `auth.secrets` (force-RLS, zero policies), `auth.user` (RLS), session management.

- `auth.auto_create_api_token_on_confirmation`
- `auth.check_api_key_revocation`
- `auth.cleanup_expired_sessions`
- `auth.drop_user_role`
- `auth.generate_api_key_token`
- `auth.jwt_verify`
- `auth.sync_user_credentials_and_roles`
- `public.auth_expire_access_keep_refresh`
- `public.auth_status`
- `public.list_active_sessions`
- `public.login`
- `public.logout`
- `public.refresh`
- `public.revoke_session`

### Import System

DDL (CREATE/DROP TABLE), session context manipulation.

- `admin.import_job_cleanup`
- `admin.import_job_generate`
- `admin.reset_import_job_user_context`
- `admin.set_import_job_user_context`
- `admin.set_optimal_import_session_settings`
- `public.get_import_job_progress`

### Worker/Derive Pipeline

Write to RLS-protected tables, DDL, worker orchestration.

- `admin.disable_temporal_triggers`
- `admin.enable_temporal_triggers`
- `worker.command_collect_changes`
- `worker.command_import_job_cleanup`
- `worker.command_task_cleanup`
- `worker.derive_reports`
- `worker.derive_statistical_history`
- `worker.derive_statistical_history_facet`
- `worker.derive_statistical_history_facet_period`
- `worker.derive_statistical_history_period`
- `worker.derive_statistical_unit`
- `worker.derive_statistical_unit_continue`
- `worker.derive_statistical_unit_facet`
- `worker.derive_statistical_unit_facet_partition`
- `worker.statistical_history_facet_reduce`
- `worker.statistical_history_reduce`
- `worker.statistical_unit_facet_reduce`
- `worker.statistical_unit_flush_staging`
- `worker.statistical_unit_refresh_batch`

### Settings/Partition Management

Write to RLS-protected tables on settings change.

- `admin.adjust_analytics_partition_count`
- `admin.propagate_partition_count_change`

### Derived Table Refresh

Bulk DELETE+INSERT on RLS-protected tables.

- `public.activity_category_used_derive`
- `public.data_source_used_derive`
- `public.region_used_derive`
- `public.sector_used_derive`

### Drilldown Functions

Performance: avoid RLS evaluation on large read-only queries.

- `public.statistical_history_drilldown`
- `public.statistical_unit_facet_drilldown`

### GraphQL Schema

Access `graphql` schema sequence (no grants to non-postgres).

- `graphql.get_schema_version`
- `graphql.increment_schema_version`

### Lifecycle Callbacks

Trigger calling DDL procedures.

- `lifecycle_callbacks.cleanup_and_generate`

### sql_saga

DDL operations (CREATE/ALTER/DROP on tables, views, triggers). Matched by schema.

- `sql_saga.__internal_add_system_time_era`
- `sql_saga.__internal_ddl_command_affects_managed_object`
- `sql_saga.add_current_view`
- `sql_saga.add_era`
- `sql_saga.add_for_portion_of_view`
- `sql_saga.add_foreign_key`
- `sql_saga.add_regular_foreign_key`
- `sql_saga.add_synchronize_temporal_columns_trigger`
- `sql_saga.add_system_versioning`
- `sql_saga.add_temporal_foreign_key`
- `sql_saga.add_unique_key`
- `sql_saga.drop_current_view`
- `sql_saga.drop_era`
- `sql_saga.drop_for_portion_of_view`
- `sql_saga.drop_foreign_key`
- `sql_saga.drop_foreign_key_by_name`
- `sql_saga.drop_protection`
- `sql_saga.drop_synchronize_temporal_columns_trigger`
- `sql_saga.drop_system_time_era`
- `sql_saga.drop_system_versioning`
- `sql_saga.drop_unique_key`
- `sql_saga.drop_unique_key_by_name`
- `sql_saga.generated_always_as_row_start_end`
- `sql_saga.health_checks`
- `sql_saga.rename_following`
- `sql_saga.set_era_ephemeral_columns`
- `sql_saga.set_system_time_era_excluded_columns`
- `sql_saga.temporal_merge_cache_maybe_purge`
- `sql_saga.truncate_system_versioning`
- `sql_saga.write_history`

